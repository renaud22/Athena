import { Controller } from '@hotwired/stimulus';

export default class extends Controller {
    static targets = ["title", "firstname", "lastname"];

    connect() {
        this.updateTitle();

        // Find inputs if targets are not set (because they are inside the prototype/widget)
        // We can't easily put data-targets on inputs generated by Symfony form theme without customizing the theme heavily.
        // So we'll use querySelector.
        this.firstnameInput = this.element.querySelector('input[name*="[firstname]"]');
        this.lastnameInput = this.element.querySelector('input[name*="[lastname]"]');

        if (this.firstnameInput) {
            this.firstnameInput.addEventListener('input', this.updateTitle.bind(this));
        }
        if (this.lastnameInput) {
            this.lastnameInput.addEventListener('input', this.updateTitle.bind(this));
        }
    }

    updateTitle() {
        if (!this.hasTitleTarget) return;

        const firstname = this.firstnameInput ? this.firstnameInput.value.trim() : '';
        const lastname = this.lastnameInput ? this.lastnameInput.value.trim() : '';

        if (firstname || lastname) {
            this.titleTarget.textContent = `Contact : ${firstname} ${lastname}`.trim();
        } else {
            // Fallback to default if empty, but we might want to keep "Contact #X" if we can retrieve the index.
            // However, the index is hardcoded in Twig loop or JS.
            // If we want to revert to "Contact #X", we need to store the original index.
            // For now, let's just leave it as is or set a generic title if empty?
            // The user said: "dès lors qu'on a un prénom et/ou un nom, on écrive plutot..."
            // So if empty, we might want to revert.
            // Let's store the initial title in a data attribute.
            if (!this.element.dataset.defaultTitle) {
                this.element.dataset.defaultTitle = this.titleTarget.textContent;
            }
            this.titleTarget.textContent = this.element.dataset.defaultTitle;
        }
    }
}
