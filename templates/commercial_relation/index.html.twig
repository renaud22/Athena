{% extends 'base.html.twig' %}

{% block title %}Relations Commerciales{% endblock %}

{% block body %}
    <div data-controller="search-filter">
        {# Header & Toolbar #}
        <div class="d-flex justify-content-between flex-wrap align-items-center pt-3 pb-4 mb-4 border-bottom border-secondary">
            <h1 class="h2 fw-bold text-uppercase tracking-wide">
                <span class="text-primary">Relations</span> Commerciales
            </h1>

            <div class="d-flex gap-3 align-items-center flex-wrap">
                {# Search #}
                <div class="position-relative">
                    <i class="bi bi-search position-absolute top-50 start-0 translate-middle-y ms-3 text-muted"></i>
                    <input type="text"
                           class="form-control bg-dark text-light border-secondary ps-5"
                           placeholder="Rechercher..."
                           data-search-filter-target="searchInput"
                           data-action="input->search-filter#filter">
                </div>

                {# Sort #}
                <select class="form-select bg-dark text-light border-secondary"
                        style="width: auto;"
                        data-search-filter-target="sortSelect"
                        data-action="change->search-filter#sort">
                    <option value="name_asc">Nom (A-Z)</option>
                    <option value="name_desc">Nom (Z-A)</option>
                    <option value="status">Statut</option>
                </select>

                {# View Toggles #}
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-outline-secondary" data-search-filter-target="viewBtn" data-mode="grid" data-action="click->search-filter#toggleView">
                        <i class="bi bi-grid-fill"></i>
                    </button>
                    <button type="button" class="btn btn-outline-secondary" data-search-filter-target="viewBtn" data-mode="list" data-action="click->search-filter#toggleView">
                        <i class="bi bi-list-ul"></i>
                    </button>
                </div>

                <a href="{{ path('app_commercial_relation_new') }}" class="btn btn-primary fw-bold">
                    <i class="bi bi-plus-lg me-2"></i>Nouvelle Relation
                </a>
            </div>
        </div>

        {# Content Container #}
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4" data-search-filter-target="container">
            {% if commercial_relations is empty %}
                <div class="col-12">
                    <div class="alert alert-info bg-dark border-secondary text-light">
                        <i class="bi bi-info-circle me-2"></i> Aucune relation commerciale trouvée.
                    </div>
                </div>
            {% else %}
                {% for commercial_relation in commercial_relations %}
                    <div class="col fade-in-up"
                         data-search-filter-target="item"
                         data-name="{{ commercial_relation.name }}"
                         data-status="{{ commercial_relation.salesStatus }}"
                         data-type="{{ commercial_relation.type }}">

                        {% embed 'partials/_card.html.twig' with {
                            title: commercial_relation.name,
                            icon: commercial_relation.type == 'Particulier' ? 'bi-person-walking' : 'bi-buildings'
                        } %}
                            {% block header_actions %}
                                {% include 'partials/_dropdown.html.twig' with {
                                    edit_path: path('app_commercial_relation_edit', {'id': commercial_relation.id}),
                                    delete_path: '#'
                                } %}
                            {% endblock %}

                            {% block body %}
                                <div class="mb-2">
                                    {% if commercial_relation.salesStatus %}
                                        {% set statusClass = 'bg-secondary' %}
                                        {% if commercial_relation.salesStatus == 'Prospect froid' %}
                                            {% set statusClass = 'badge-status-cold' %}
                                        {% elseif commercial_relation.salesStatus == 'Prospect tiède' %}
                                            {% set statusClass = 'badge-status-warm' %}
                                        {% elseif commercial_relation.salesStatus == 'Prospect chaud' %}
                                            {% set statusClass = 'badge-status-hot' %}
                                        {% elseif commercial_relation.salesStatus == 'Client actif' %}
                                            {% set statusClass = 'badge-status-active' %}
                                        {% elseif commercial_relation.salesStatus == 'Ancien client' %}
                                            {% set statusClass = 'badge-status-former' %}
                                        {% elseif commercial_relation.salesStatus == 'Disqualifié' %}
                                            {% set statusClass = 'badge-status-disqualified' %}
                                        {% endif %}

                                        <span class="badge {{ statusClass }} rounded-1">{{ commercial_relation.salesStatus }}</span>
                                    {% endif %}
                                </div>

                                <div class="d-flex flex-wrap gap-1">
                                    {% for type in commercial_relation.relationTypes %}
                                        <span class="badge bg-dark border border-secondary text-muted small fw-normal">{{ type }}</span>
                                    {% endfor %}
                                </div>
                            {% endblock %}

                            {% block footer %}
                                <div class="d-flex justify-content-between align-items-center w-100 text-muted small">
                                    <span><i class="bi bi-people me-1"></i> {{ commercial_relation.contacts|length }} Contact(s)</span>

                                    <a href="{{ path('app_commercial_relation_show', {'id': commercial_relation.id}) }}" class="btn btn-sm btn-outline-primary rounded-pill px-3">
                                        Détails <i class="bi bi-arrow-right ms-1"></i>
                                    </a>
                                </div>
                            {% endblock %}
                        {% endembed %}
                    </div>
                {% endfor %}
            {% endif %}
        </div>
    </div>
{% endblock %}
